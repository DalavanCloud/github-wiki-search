regexes = {
    source: /source:(github enterprise|github.com|jira)\s*/i,
    type: /type:(issue|readme|wiki|gh page)\s*/i,
    loc: /loc:(\S+)\s*/i,
    author: /author:(\S+)\s*/i,
    assignee: /assignee:(\S+)\s*/i,
    from: /from:(\S+)\s*/i,
    to: /to:(\S+)\s*/i,
};
 
process_query = function(raw_query) {
    // given a search query string, return a query object with all the filters
    var processed_query = {
        query: raw_query || '',
    };
 
    for (var keyword in regexes) {
        var regex = regexes[keyword];
        var match = regex.exec(processed_query.query);
        if (match) {
            processed_query[keyword] = match[1];
            console.log(keyword, regex, processed_query);
            processed_query.query = processed_query.query.replace(regex, '');
        }
    }
    processed_query.query = processed_query.query.replace(/^\s+|\s+$/g,'');
    return processed_query;
};
 
build_query = function(processed_query) {
    // given a query object, return a query string
    query = processed_query.query || '';
    for (var keyword in processed_query) {
        if (keyword == 'query') {continue;}
        var value = processed_query[keyword];
        query += ' ' + keyword + ':' + value;
    }
    return query;
};

set_filters = function(query_obj) {
    // given a query object (generated by process_query), set the filters form

};

get_filters = function() {
    // get a query object from the current filter state

};

get_hash = function() {
    // get the hash of the form `#/?a=b&c=d` and parse it into an object
    // {a: 'b', c: 'd'}
    var params = {};
    var hash = window.location.hash.slice(3);
    var processed_hash = hash.split('&');
    for (var i=0; i<processed_hash.length; i++) {
        var param = processed_hash[i].split('=');
        var k = decodeURIComponent(param[0]);
        var v = decodeURIComponent(param[1]);
        params[k] = v;
    }
    return params;
};

set_hash = function(obj) {
    // given an object, serialize it to a query string and insert it into hash.
    var params = [];
    for (var k in obj) {
        v = obj[k];
        params.push(encodeURIComponent(k) + '=' + encodeURIComponent(v));
    }
    var hash = '#/?' + params.join('&');
    window.location.hash = hash;
};
